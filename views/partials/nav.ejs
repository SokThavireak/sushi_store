<nav class="fixed top-0 w-full z-50 transition-all duration-300 backdrop-blur-md bg-white/90 dark:bg-gray-900/90 border-b border-gray-100/50 dark:border-gray-800 shadow-sm">
  <div class="max-w-7xl mx-auto px-4 py-3 lg:px-8 lg:py-4">
    <div class="flex justify-between items-center">

      <div class="text-2xl lg:text-3xl font-extrabold tracking-tight z-50">
        <a href="<%= (typeof user !== 'undefined' && user.role === 'staff') ? '/staff/menu' : '/' %>"
          class="text-gray-900 dark:text-white">Murakami<span class="text-orange-500">.</span></a>
        </a>
      </div>

      <div class="hidden lg:flex items-center gap-8 text-sm font-bold text-gray-800 dark:text-gray-200">
        <% if (typeof user==='undefined' || user.role !=='staff' ) { %>
          <a href="/" class="hover:text-orange-500 transition-colors">Home</a>
          <a href="/menu" class="hover:text-orange-500 transition-colors">Menu</a>
          <a href="/about" class="hover:text-orange-500 transition-colors">About</a>
          <a href="/offers" class="hover:text-orange-500 transition-colors">Offers</a>
          <a href="/location" class="hover:text-orange-500 transition-colors">Locations</a>
          <% } %>
      </div>

      <div class="flex items-center gap-3 lg:gap-6">

        <% if (typeof user !=='undefined' && user) { %>
          <% if (user.role==='manager' || user.role==='admin' || user.role==='store_manager' || user.role==='cashier' )
            { %>
            <a href="/admin/dashboard" class="hidden lg:block text-sm font-bold text-gray-800 dark:text-gray-200 hover:text-orange-500">Dashboard</a>
            <% } %>

              <% if (user.role==='manager' || user.role==='admin' || user.role==='store_manager' || user.role==='staff'
                || user.role==='cashier' ) { %>
                <a href="/staff/menu" class="hidden lg:block text-sm font-bold text-gray-800 dark:text-gray-200 hover:text-orange-500">Menu Staff</a>
                <% } %>

                  <div class="relative">
                    <button onclick="toggleProfileMenu()"
                      class="flex items-center justify-center w-10 h-10 bg-gray-100 dark:bg-gray-800 rounded-full hover:bg-orange-100 text-gray-700 dark:text-gray-200 transition-all focus:outline-none">
                      <i class="fa-solid fa-user"></i>
                    </button>

                    <div id="profile-menu"
                      class="hidden absolute right-0 mt-3 w-48 bg-white dark:bg-gray-800 rounded-xl shadow-xl border border-gray-100 dark:border-gray-700 overflow-hidden z-50 animate-fade-in-down">
                      <div class="px-4 py-3 bg-gray-50 dark:bg-gray-700 border-b border-gray-100 dark:border-gray-600">
                        <p class="text-xs text-gray-500 dark:text-gray-400">Signed in as</p>
                        <p class="text-sm font-bold text-gray-800 dark:text-white truncate">
                          <%= user.email.split('@')[0] %>
                        </p>
                      </div>
                      <a href="/profile"
                        class="block px-4 py-3 text-sm text-gray-700 dark:text-gray-300 hover:bg-orange-50 dark:hover:bg-gray-700 transition-colors">
                        <i class="fa-solid fa-gear mr-2 text-gray-400"></i> Manage Account
                      </a>
                      <a href="/orders"
                        class="block px-4 py-3 text-sm text-gray-700 dark:text-gray-300 hover:bg-orange-50 dark:hover:bg-gray-700 transition-colors">
                        <i class="fa-solid fa-receipt mr-2 text-gray-400"></i> Orders
                      </a>
                      <a href="/logout"
                        class="block px-4 py-3 text-sm text-red-600 dark:text-red-400 hover:bg-red-50 dark:hover:bg-red-900/20 transition-colors border-t border-gray-100 dark:border-gray-700">
                        <i class="fa-solid fa-right-from-bracket mr-2"></i> Logout
                      </a>
                    </div>
                  </div>

                  <% } else { %>
                    <a href="/login"
                      class="text-sm font-bold text-gray-800 dark:text-gray-200 hover:text-orange-500 transition-colors">
                      Login
                    </a>
                    <% } %>

                      <button onclick="toggleTheme()"
                        class="w-10 h-10 flex items-center justify-center text-gray-700 dark:text-gray-200 hover:text-orange-500 dark:hover:text-orange-500 transition focus:outline-none">
                        <i id="theme-icon" class="fa-solid fa-moon text-xl"></i>
                      </button>

                      <button onclick="toggleCart()"
                        class="relative w-10 h-10 flex items-center justify-center text-gray-700 dark:text-gray-200 hover:text-orange-500 transition">
                        <i class="fa-solid fa-shopping-bag text-xl"></i>
                        <span id="cart-count"
                          class="absolute top-0 right-0 bg-orange-600 text-white text-[10px] font-bold w-4 h-4 flex items-center justify-center rounded-full shadow-sm">0</span>
                      </button>

                      <button onclick="toggleMobileMenu()"
                        class="lg:hidden w-10 h-10 flex items-center justify-center text-gray-800 dark:text-white hover:bg-gray-100 dark:hover:bg-gray-800 rounded-full transition-colors focus:outline-none">
                        <i id="menu-icon" class="fa-solid fa-bars text-xl"></i>
                      </button>
      </div>
    </div>
  </div>

  <div id="mobile-menu" class="hidden lg:hidden bg-white dark:bg-gray-900 border-t border-gray-100 dark:border-gray-800 absolute w-full left-0 shadow-lg">
    <div class="flex flex-col p-4 space-y-2">
      <% if (typeof user==='undefined' || user.role !=='staff' ) { %>
        <a href="/" class="mobile-link">
          <i class="fa-solid fa-house w-6 text-center text-gray-400"></i> Home
        </a>
        <a href="/menu" class="mobile-link">
          <i class="fa-solid fa-utensils w-6 text-center text-gray-400"></i> Menu
        </a>
        <a href="/about" class="mobile-link">
          <i class="fa-solid fa-circle-info w-6 text-center text-gray-400"></i> About
        </a>
        <a href="/offers" class="mobile-link">
          <i class="fa-solid fa-tag w-6 text-center text-gray-400"></i> Offers
        </a>
        <a href="/location" class="mobile-link">
          <i class="fa-solid fa-map-location-dot w-6 text-center text-gray-400"></i> Locations
        </a>
        <% if (typeof user === 'undefined' || !user) { %>
          <div class="border-t border-gray-100 dark:border-gray-800 my-2 pt-2"></div>
          <a href="/login" class="mobile-link text-orange-600 dark:text-orange-500">
            <i class="fa-solid fa-right-to-bracket w-6 text-center"></i> Login
          </a>
        <% } %>
        <% } %>
        

          <% if (typeof user !=='undefined' && (user.role==='manager' || user.role==='admin' ||
            user.role==='store_manager' )) { %>
            <div class="border-t border-gray-100 dark:border-gray-800 my-2 pt-2"></div>
            <a href="/admin/dashboard" class="mobile-link text-blue-600 bg-blue-50 dark:bg-blue-900/20 dark:text-blue-400">
              <i class="fa-solid fa-chart-pie w-6 text-center"></i> Dashboard
            </a>
            <% } %>
    </div>
  </div>
</nav>

<style>
  .mobile-link {
    display: flex;
    align-items: center;
    padding: 12px 16px;
    color: #374151; /* gray-700 */
    font-weight: 600;
    border-radius: 0.5rem;
    transition: all 0.2s;
  }
  
  /* Added Dark Mode support for Mobile Link */
  :is(.dark .mobile-link) {
    color: #e5e7eb; /* gray-200 */
  }

  .mobile-link:hover {
    background-color: #f3f4f6; /* gray-100 */
    color: #f97316; /* orange-500 */
  }
  
  :is(.dark .mobile-link:hover) {
    background-color: #1f2937; /* gray-800 */
    color: #f97316;
  }

  .animate-fade-in-down {
    animation: fadeInDown 0.2s ease-out;
  }

  @keyframes fadeInDown {
    from {
      opacity: 0;
      transform: translateY(-10px);
    }

    to {
      opacity: 1;
      transform: translateY(0);
    }
  }
</style>

<script>
// Toggle Dark Mode
function toggleTheme() {
  const html = document.documentElement;
  const icon = document.getElementById('theme-icon');
  if (html.classList.contains('dark')) {
    html.classList.remove('dark');
    localStorage.setItem('theme', 'light');
    if(icon) { icon.classList.remove('fa-sun'); icon.classList.add('fa-moon'); }
  } else {
    html.classList.add('dark');
    localStorage.setItem('theme', 'dark');
    if(icon) { icon.classList.remove('fa-moon'); icon.classList.add('fa-sun'); }
  }
}

// Set initial icon on load
document.addEventListener('DOMContentLoaded', () => {
    const icon = document.getElementById('theme-icon');
    if (document.documentElement.classList.contains('dark') && icon) {
        icon.classList.remove('fa-moon');
        icon.classList.add('fa-sun');
    }
});

// Toggle Mobile Menu
  function toggleMobileMenu() {
    const menu = document.getElementById("mobile-menu");
    const icon = document.getElementById("menu-icon");
    // Toggle Visibility
    menu.classList.toggle("hidden");

    // Toggle Icon (Bars <-> X)
    if (menu.classList.contains("hidden")) {
      icon.classList.remove("fa-xmark");
      icon.classList.add("fa-bars");
    } else {
      icon.classList.remove("fa-bars");
      icon.classList.add("fa-xmark");
    }
  }

  // Toggle Profile Menu (Desktop)
  function toggleProfileMenu() {
    const menu = document.getElementById("profile-menu");
    menu.classList.toggle("hidden");
  }

  // Close menus when clicking outside
  window.addEventListener("click", function (e) {
    // Close Profile Menu
    const profileBtn = document.querySelector('button[onclick="toggleProfileMenu()"]');
    const profileMenu = document.getElementById("profile-menu");
    if (profileBtn && profileMenu && !profileBtn.contains(e.target) && !profileMenu.contains(e.target)) {
      profileMenu.classList.add("hidden");
    }
  });
</script>